---
import PlotFigure from "../components/PlotFigure.astro";
import Layout from "../layouts/Layout.astro";
import * as Plot from "@observablehq/plot";
import departements from "../assets/departements.geojson.json";
import populationMain from "../assets/populationMain.json";

let selectedYear = 2015;
let selectedSex = "Total";
let selectedAge = "Total";

const optionPlot = {
  projection: {
    type: "mercator", //utiliser une projection adaptée
    domain: departements, // Domain pour centrer la carte sur la france
  },
  color: {
    type: "quantile",
    n: 8,
    scheme: "Greens",
    label: "Population en centaine de milliers",
    legend: true,
    transform: (d) => Math.round(d / 100000),
  },
  marks: [
    Plot.geo(departements, {
      fill: (d) => {
        const deptName = d.properties.nom; //Nom du département dans le geoJson
        const popData = populationMain.find(
          (p) =>
            p.Géographie === deptName &&
            p.Période === selectedYear &&
            p.Sexe === selectedSex &&
            p["Âge"] === selectedAge
        ); //trouver les données correspondantes
        return popData.Valeur; //Coloriser en fonction de la valeur
      },
      stroke: "#999",
      title: (d) => {
        const deptName = d.properties.nom; //Nom du département dans le geoJson
        const popData = populationMain.find(
          (p) =>
            p.Géographie === deptName &&
            p.Période === selectedYear &&
            p.Sexe === selectedSex &&
            p["Âge"] === selectedAge
        ); //trouver les données correspondantes
        return `${deptName} : ${popData.Valeur}`; //Coloriser en fonction de la valeur
      },
      tip: true,
    }),
  ],
};
---

<Layout>
  <h1 class="text-2xl">Carte de la Population par Département</h1>
  <h2 class="text-xl mt-4">Données pour l'année 2015</h2>
  
  <PlotFigure options={optionPlot} />
  
  <a href="/" class="back-link">← Retour à l'accueil</a>
</Layout>

<style>
  .back-link {
    display: inline-block;
    margin-top: 2rem;
    color: #0066cc;
    text-decoration: none;
  }
  
  .back-link:hover {
    text-decoration: underline;
  }
</style>
